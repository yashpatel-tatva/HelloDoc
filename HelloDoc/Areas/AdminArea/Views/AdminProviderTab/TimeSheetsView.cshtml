@using DataModels.AdminSideViewModels
@model BiWeekViewModel

<style>
    table {
        width: 100%;
    }

    th, td {
        padding: 0.5rem;
        /*text-align: center;*/
        /*color: #212529bf !important;*/
        vertical-align: middle;
    }

    .form-group input {
        padding: 5px 10px;
    }

    .form-group {
        width: 80%
    }
</style>
<div class="container">
    <div class="d-flex justify-content-end mx-3">
        <input type="hidden" id="timesheetphysicianid" value="@Model.Physicianid" />
        <input type="hidden" id="timesheetdate" value="@Model.Firstday" />
        @* <a>
        <button type="button" class="d-flex babtn rounded align-item-center p-1 px-2" id="backtoedit">
        <div><img src="~/res/back.png" width="15px" height="10px"></div>
        <div><span>Back</span></div>
        </button>
        </a>*@
    </div>
    <div class="bg-light rounded m-3 shadow" id="content">
        <div class="table-responsive">
            <table class="table table-hover mt-1">
                <thead style="--bs-table-bg: rgb(235, 235, 235) ; color: black !important">
                    <tr>
                        <th style="width : 15%">Date</th>
                        <th style="width : 8%">On-Call Hours</th>
                        <th style="width : 20%">Total Hours</th>
                        <th style="width : 5%">Weekend/Holiday</th>
                        <th style="width : 20%">Number of Housecalls</th>
                        <th style="width : 20%">Number of Phone Consults</th>
                        <th style="width : 12%"></th>
                    </tr>
                </thead>
                <tbody>
                    <input type="hidden" id="timesheetphysicianid" asp-for="Physicianid" value="@Model.Physicianid" />
                    <input type="hidden" id="timesheetdate" asp-for="Firstday" value="@Model.Firstday" />
                    @foreach (var item in Model.TimeSheets)
                    {
                        <form data-id="@item.Id" data-name="@item.ThisDate" class="form" method="post">
                        <tr>
                            <td>@item.ThisDate.ToString("dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture)</td>
                            <td>
                                    @if (item.OnCallHours == TimeOnly.MinValue)
                                    {
                                        @: 0
                                    }
                                    else
                                    {
                                        @item.OnCallHours
                                    }
                            </td>
                            <td>
                                <div class="form-group d-flex align-items-center rounded">
                                    <input type="time" class="form-control oncall" placeholder="" id="oncall_@item.Id" asp-for="@item.OnCallHours" value="@item.OnCallHours">
                                </div>
                            </td>
                            <td style="text-align : center">
                                <div class="form-check form-check-inline ">
                                    <input type="checkbox" name="weekend" id="weekend_@item.Id" class="form-check-input"
                                        @if (item.IsWeekend)
                                        {
                                            @: checked
                                        } />
                                </div>
                            </td>
                            <td>
                                <div class="form-group d-flex align-items-center rounded">
                                    <input type="number" class="form-control housecall" placeholder="" id="housecall_@item.Id" asp-for="@item.HouseCalls" value="@item.HouseCalls">
                                </div>
                            </td>
                            <td>
                                <div class="form-group d-flex align-items-center rounded">
                                    <input type="number" class="form-control consult" placeholder="" id="phonecall_@item.Id" asp-for="@item.PhoneCalls" value="@item.PhoneCalls">
                                </div>
                            </td>
                            <td></td>
                        </tr>
                        </form>
                    }
                    <tr>
                        <td colspan="7" style="text-align : right">
                            <button type="button" class=" p-2 px-3 text-white bg-info rounded border-info px-3 shadow-none" id="submit">Submit</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="m-3">
        <button type="button" class=" p-2 px-3 text-white bg-info rounded border-info   px-3 shadow-none" id="addreceipt">Add Receipt</button>
    </div>
    <div id="receipts"></div>
    <div class="d-flex justify-content-end m-3">
        <button type="button" class=" p-2 px-3 text-white bg-info rounded border-info   px-3 shadow-none" id="finalizethistimesheet">Finalize</button>
    </div>
</div>

<script>
    $('#addreceipt').on('click', function () {
        var physicianid = $('#timesheetphysicianid').val();
        var date = $('#timesheetdate').val();
        console.log(physicianid, date);
        $.ajax({
            url: '/AdminArea/AdminProviderTab/ReimbursementData',
            data: { physicianid, date },
            //type: 'POST',
            success: function (result) {
                $('#receipts').html(result);
            }
        })
    })
    $('#submit').on('click', function () {
        var physicianid = $('#timesheetphysicianid').val();
        var firstday = $('#timesheetdate').val();
        var timesheets = $('.form').map(function () {
            return {
                Id: $(this).data('id'),
                ThisDate: $(this).data('name'),
                IsWeekend: $('#weekend_' + $(this).data('id')).prop('checked'),
                OnCallHours: $('#oncall_' + $(this).data('id')).val(),
                HouseCalls: $('#housecall_' + $(this).data('id')).val(),
                PhoneCalls: $('#phonecall_' + $(this).data('id')).val()
            };
        }).get()
        console.log(physicianid, firstday, timesheets);
        $.ajax({
            url: '/AdminArea/AdminProviderTab/EditTimeSheet',
            type: 'POST',
            data: { physicianid, firstday, timesheets },
            success: function () {
                Swal.fire({
                    position: "top-end",
                    icon: "success",
                    title: "Your work has been saved",
                    showConfirmButton: false,
                    timer: 1500
                });
            }
        })
    });

    $('#finalizethistimesheet').on('click' , function(){
        var physicianid = $('#timesheetphysicianid').val();
        var date = $('#timesheetdate').val();
        console.log(physicianid, date);
        $.ajax({
            url: '/AdminArea/AdminProviderTab/FinalizeThisTimeSheet',
            data: { physicianid, date },
            //type: 'POST',
            success: function (result) {
                location.reload();
            }
        })
    })
</script>